<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data: exploration &amp; transformation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="e-commerce-analytics_files/libs/clipboard/clipboard.min.js"></script>
<script src="e-commerce-analytics_files/libs/quarto-html/quarto.js"></script>
<script src="e-commerce-analytics_files/libs/quarto-html/popper.min.js"></script>
<script src="e-commerce-analytics_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="e-commerce-analytics_files/libs/quarto-html/anchor.min.js"></script>
<link href="e-commerce-analytics_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="e-commerce-analytics_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="e-commerce-analytics_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="e-commerce-analytics_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="e-commerce-analytics_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Data: exploration &amp; transformation</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- <font size='6'>E-commerce Analytics</font><br><br>
<font size='6'><b>Sales & Market Basket Analysis</b></font><br><br>

<font size='4'>Antonio Buzzelli</font><br>
<font size='4'>March 2023</font> -->
<p>The e-commerce industry has experienced significant growth in recent years, and online sales have become an increasingly important aspect of many businesses. Analyzing sales data can help businesses understand customer behavior and identify trends, which can then be used to improve their overall sales strategies. In this notebook, we will be analyzing a sales dataset from an e-commerce company to gain insights into their sales patterns. Our analysis will cover various aspects of the data, including temporal trends and customer geographical segmentation. We will also be performing a market basket analysis to identify relationships between products and suggest strategies for improving sales. By the end of this notebook, we aim to provide a comprehensive understanding of the sales data, which can then be used to make informed decisions and drive business growth.</p>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2023-04-02T18:30:33.230074Z&quot;,&quot;start_time&quot;:&quot;2023-04-02T18:30:32.875279Z&quot;}" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># %pip install pandas statsmodels mlxtend jupyterthemes</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>::: {.cell ExecuteTime=‘{“end_time”:“2023-04-02T18:30:33.449961Z”,“start_time”:“2023-04-02T18:30:32.875508Z”}’ _cell_guid=‘b1076dfc-b9ad-4769-8c92-a6c4dae69d19’ _uuid=‘8f2839f25d086af736a60e9eeb907d3b93b6e0e5’ execution_count=2}</p>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dataframes</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># dataviz</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># from jupyterthemes import jtplot</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># jtplot.style(theme='monokai', context='notebook', grid=False)</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># hypothesis testing</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> ttest_ind</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> f_oneway</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.stats.multicomp <span class="im">import</span> pairwise_tukeyhsd</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co"># market basket analysis</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> itertools <span class="im">import</span> permutations</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mlxtend.preprocessing <span class="im">import</span> TransactionEncoder</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mlxtend.frequent_patterns <span class="im">import</span> apriori, association_rules</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>:::</p>
<p>Before diving into any analysis, it is essential to explore and transform the data to ensure its quality, completeness, and correctness. In this chapter, we will be exploring and transforming the e-commerce sales dataset to prepare it for our analysis. Our primary goal will be to check for data integrity, handle missing values, and ensure that all variables are in the correct format. We will also be creating new variables that will be useful in our analysis. This chapter will provide a foundation for the rest of our analysis, and the data exploration and transformation techniques used here will be applicable in many other scenarios. By the end of this chapter, we will have a cleaned and prepared dataset ready for our analysis, allowing us to focus on extracting meaningful insights.</p>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2023-04-02T18:30:35.128988Z&quot;,&quot;start_time&quot;:&quot;2023-04-02T18:30:32.893242Z&quot;}" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'sales.csv'</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 536350 entries, 0 to 536349
Data columns (total 8 columns):
 #   Column         Non-Null Count   Dtype  
---  ------         --------------   -----  
 0   TransactionNo  536350 non-null  object 
 1   Date           536350 non-null  object 
 2   ProductNo      536350 non-null  object 
 3   ProductName    536350 non-null  object 
 4   Price          536350 non-null  float64
 5   Quantity       536350 non-null  int64  
 6   CustomerNo     536295 non-null  float64
 7   Country        536350 non-null  object 
dtypes: float64(2), int64(1), object(5)
memory usage: 32.7+ MB</code></pre>
</div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2023-04-02T18:30:35.151807Z&quot;,&quot;start_time&quot;:&quot;2023-04-02T18:30:32.893509Z&quot;}" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">TransactionNo</th>
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th">ProductNo</th>
<th data-quarto-table-cell-role="th">ProductName</th>
<th data-quarto-table-cell-role="th">Price</th>
<th data-quarto-table-cell-role="th">Quantity</th>
<th data-quarto-table-cell-role="th">CustomerNo</th>
<th data-quarto-table-cell-role="th">Country</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>581482</td>
<td>12/9/2019</td>
<td>22485</td>
<td>Set Of 2 Wooden Market Crates</td>
<td>21.47</td>
<td>12</td>
<td>17490.0</td>
<td>United Kingdom</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>581475</td>
<td>12/9/2019</td>
<td>22596</td>
<td>Christmas Star Wish List Chalkboard</td>
<td>10.65</td>
<td>36</td>
<td>13069.0</td>
<td>United Kingdom</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>581475</td>
<td>12/9/2019</td>
<td>23235</td>
<td>Storage Tin Vintage Leaf</td>
<td>11.53</td>
<td>12</td>
<td>13069.0</td>
<td>United Kingdom</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>581475</td>
<td>12/9/2019</td>
<td>23272</td>
<td>Tree T-Light Holder Willie Winkie</td>
<td>10.65</td>
<td>12</td>
<td>13069.0</td>
<td>United Kingdom</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>581475</td>
<td>12/9/2019</td>
<td>23239</td>
<td>Set Of 4 Knick Knack Tins Poppies</td>
<td>11.94</td>
<td>6</td>
<td>13069.0</td>
<td>United Kingdom</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">536345</td>
<td>C536548</td>
<td>12/1/2018</td>
<td>22168</td>
<td>Organiser Wood Antique White</td>
<td>18.96</td>
<td>-2</td>
<td>12472.0</td>
<td>Germany</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">536346</td>
<td>C536548</td>
<td>12/1/2018</td>
<td>21218</td>
<td>Red Spotty Biscuit Tin</td>
<td>14.09</td>
<td>-3</td>
<td>12472.0</td>
<td>Germany</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">536347</td>
<td>C536548</td>
<td>12/1/2018</td>
<td>20957</td>
<td>Porcelain Hanging Bell Small</td>
<td>11.74</td>
<td>-1</td>
<td>12472.0</td>
<td>Germany</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">536348</td>
<td>C536548</td>
<td>12/1/2018</td>
<td>22580</td>
<td>Advent Calendar Gingham Sack</td>
<td>16.35</td>
<td>-4</td>
<td>12472.0</td>
<td>Germany</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">536349</td>
<td>C536548</td>
<td>12/1/2018</td>
<td>22767</td>
<td>Triple Photo Frame Cornice</td>
<td>20.45</td>
<td>-2</td>
<td>12472.0</td>
<td>Germany</td>
</tr>
</tbody>
</table>

<p>536350 rows × 8 columns</p>
</div>
</div>
</div>
<p>Here above, a glimpse of the data at our disposal. The dataset is composed by the following original variables:</p>
<ul>
<li>TransactionNo (categorical): a six-digit unique number that defines each transaction. The letter “C” in the code indicates a cancellation.</li>
<li>Date (numeric): the date when each transaction was generated.</li>
<li>ProductNo (categorical): a five or six-digit unique character used to identify a specific product.</li>
<li>Product (categorical): product/item name.</li>
<li>Price (numeric): the price of each product per unit in pound sterling (£).</li>
<li>Quantity (numeric): the quantity of each product per transaction. Negative values related to cancelled transactions.</li>
<li>CustomerNo (categorical): a five-digit unique number that defines each customer.</li>
<li>Country (categorical): name of the country where the customer resides.</li>
</ul>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2023-04-02T18:30:35.958997Z&quot;,&quot;start_time&quot;:&quot;2023-04-02T18:30:32.908924Z&quot;}" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Validating variable types</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Date'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'Date'</span>])</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">'ProductNo'</span>, <span class="st">'CustomerNo'</span>]] <span class="op">=</span> df[[<span class="st">'ProductNo'</span>, <span class="st">'CustomerNo'</span>]].astype(<span class="st">'object'</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Splitting `Date` column</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Month'</span>] <span class="op">=</span> df[<span class="st">'Date'</span>].dt.month</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Weekday'</span>] <span class="op">=</span> df[<span class="st">'Date'</span>].dt.weekday</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'WeekdayName'</span>] <span class="op">=</span> df[<span class="st">'Date'</span>].dt.day_name()</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Day'</span>] <span class="op">=</span> df[<span class="st">'Date'</span>].dt.day</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a `TotalPrice` colum</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Amount'</span>] <span class="op">=</span> df[<span class="st">'Quantity'</span>] <span class="op">*</span> df[<span class="st">'Price'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="returns" class="level2">
<h2 class="anchored" data-anchor-id="returns">Returns</h2>
<p>The most notable characteristic of this dataset is the presence of <em>returns</em>, represented by negative values in the <code>Quantity</code> variable. In this section we are going to gain insights on this feature to understand how to deal with it for further analysis.</p>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2023-04-02T18:30:36.039441Z&quot;,&quot;start_time&quot;:&quot;2023-04-02T18:30:32.920891Z&quot;}" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We create a boolean variable to identify if a product is returned or not</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Return'</span>] <span class="op">=</span> np.where(df[<span class="st">'Quantity'</span>] <span class="op">&lt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a boolean variable to show if the product is within a broader order or not</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'SingleOrder'</span>] <span class="op">=</span> df.duplicated(<span class="st">'TransactionNo'</span>).astype(<span class="bu">int</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Percentage of products sold within a broader order: </span><span class="sc">{</span><span class="dv">1</span> <span class="op">-</span> <span class="bu">sum</span>(df[<span class="st">'SingleOrder'</span>]) <span class="op">/</span> df<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating another `TotalPrice` column that takes into consideration returns (represented by -n values in the `Quantity` column).</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'AmountN'</span>] <span class="op">=</span> np.where(df[<span class="st">'Amount'</span>] <span class="op">&lt;</span> <span class="dv">0</span>, <span class="dv">0</span>, df[<span class="st">'Amount'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Percentage of products sold within a broader order: 0.043262794816817385</code></pre>
</div>
</div>
<p>Do returned products (return-labelled observations) come in specific transactions or are they mixed with non-returned products?</p>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2023-04-02T18:30:36.190622Z&quot;,&quot;start_time&quot;:&quot;2023-04-02T18:30:32.933021Z&quot;}" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>transactionReturned <span class="op">=</span> df.loc[df[<span class="st">'Return'</span>] <span class="op">==</span> <span class="dv">1</span>, <span class="st">'TransactionNo'</span>]</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>df[(df[<span class="st">'Return'</span>] <span class="op">==</span> <span class="dv">0</span>) <span class="op">&amp;</span> (df[<span class="st">'TransactionNo'</span>].isin(transactionReturned))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">TransactionNo</th>
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th">ProductNo</th>
<th data-quarto-table-cell-role="th">ProductName</th>
<th data-quarto-table-cell-role="th">Price</th>
<th data-quarto-table-cell-role="th">Quantity</th>
<th data-quarto-table-cell-role="th">CustomerNo</th>
<th data-quarto-table-cell-role="th">Country</th>
<th data-quarto-table-cell-role="th">Month</th>
<th data-quarto-table-cell-role="th">Weekday</th>
<th data-quarto-table-cell-role="th">WeekdayName</th>
<th data-quarto-table-cell-role="th">Day</th>
<th data-quarto-table-cell-role="th">Amount</th>
<th data-quarto-table-cell-role="th">Return</th>
<th data-quarto-table-cell-role="th">SingleOrder</th>
<th data-quarto-table-cell-role="th">AmountN</th>
</tr>
</thead>
<tbody>
</tbody>
</table>

</div>
</div>
</div>
<p>Returned products have specific transaction IDs (<code>TransactionNo</code>).</p>
<p>Do all returned-labelled observations begin with the letter ‘C’?</p>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2023-04-02T18:30:36.203476Z&quot;,&quot;start_time&quot;:&quot;2023-04-02T18:30:32.946830Z&quot;}" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>np.<span class="bu">all</span>(np.char.startswith(transactionReturned.unique().astype(<span class="bu">str</span>), <span class="st">'C'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>True</code></pre>
</div>
</div>
<p>Comparing the total number of observations in which <code>TransactionNo</code> starts with ‘C’ with the total number of observations that have been precedently labelled as “returns”:</p>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2023-04-02T18:30:36.485790Z&quot;,&quot;start_time&quot;:&quot;2023-04-02T18:30:32.959297Z&quot;}" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>return2 <span class="op">=</span> np.where(df[<span class="st">'TransactionNo'</span>].<span class="bu">str</span>.startswith(<span class="st">'C'</span>), <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[<span class="st">'Return'</span>].<span class="bu">sum</span>())</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(return2.<span class="bu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>8585
8585</code></pre>
</div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2023-04-02T18:30:36.724447Z&quot;,&quot;start_time&quot;:&quot;2023-04-02T18:30:32.959505Z&quot;}" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>transno_c <span class="op">=</span> df[df[<span class="st">'TransactionNo'</span>].<span class="bu">str</span>.<span class="bu">slice</span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="op">==</span> <span class="st">'C'</span>][<span class="st">'TransactionNo'</span>].<span class="bu">str</span>.<span class="bu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>df[df[<span class="st">'TransactionNo'</span>].isin(transno_c)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">TransactionNo</th>
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th">ProductNo</th>
<th data-quarto-table-cell-role="th">ProductName</th>
<th data-quarto-table-cell-role="th">Price</th>
<th data-quarto-table-cell-role="th">Quantity</th>
<th data-quarto-table-cell-role="th">CustomerNo</th>
<th data-quarto-table-cell-role="th">Country</th>
<th data-quarto-table-cell-role="th">Month</th>
<th data-quarto-table-cell-role="th">Weekday</th>
<th data-quarto-table-cell-role="th">WeekdayName</th>
<th data-quarto-table-cell-role="th">Day</th>
<th data-quarto-table-cell-role="th">Amount</th>
<th data-quarto-table-cell-role="th">Return</th>
<th data-quarto-table-cell-role="th">SingleOrder</th>
<th data-quarto-table-cell-role="th">AmountN</th>
</tr>
</thead>
<tbody>
</tbody>
</table>

</div>
</div>
</div>
<p>Transaction IDs for returned products are different from the IDs of non-returned products, and they begin with letter ‘C’.</p>
</section>
<section id="missing-values" class="level2">
<h2 class="anchored" data-anchor-id="missing-values">Missing values</h2>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2023-04-02T18:30:37.586739Z&quot;,&quot;start_time&quot;:&quot;2023-04-02T18:30:32.983426Z&quot;}" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>(df.isnull().<span class="bu">sum</span>() <span class="op">/</span> df.shape[<span class="dv">0</span>]).sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>CustomerNo       0.000103
TransactionNo    0.000000
Date             0.000000
ProductNo        0.000000
ProductName      0.000000
Price            0.000000
Quantity         0.000000
Country          0.000000
Month            0.000000
Weekday          0.000000
WeekdayName      0.000000
Day              0.000000
Amount           0.000000
Return           0.000000
SingleOrder      0.000000
AmountN          0.000000
dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2023-04-02T18:30:37.634970Z&quot;,&quot;start_time&quot;:&quot;2023-04-02T18:30:32.983587Z&quot;}" data-execution_count="12">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>nulls <span class="op">=</span> df[df[<span class="st">'CustomerNo'</span>].isnull()]</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>nulls.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">TransactionNo</th>
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th">ProductNo</th>
<th data-quarto-table-cell-role="th">ProductName</th>
<th data-quarto-table-cell-role="th">Price</th>
<th data-quarto-table-cell-role="th">Quantity</th>
<th data-quarto-table-cell-role="th">CustomerNo</th>
<th data-quarto-table-cell-role="th">Country</th>
<th data-quarto-table-cell-role="th">Month</th>
<th data-quarto-table-cell-role="th">Weekday</th>
<th data-quarto-table-cell-role="th">WeekdayName</th>
<th data-quarto-table-cell-role="th">Day</th>
<th data-quarto-table-cell-role="th">Amount</th>
<th data-quarto-table-cell-role="th">Return</th>
<th data-quarto-table-cell-role="th">SingleOrder</th>
<th data-quarto-table-cell-role="th">AmountN</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">6511</td>
<td>C581406</td>
<td>2019-12-08</td>
<td>46000M</td>
<td>Polyester Filler Pad 45x45cm</td>
<td>6.19</td>
<td>-240</td>
<td>NaN</td>
<td>United Kingdom</td>
<td>12</td>
<td>6</td>
<td>Sunday</td>
<td>8</td>
<td>-1485.60</td>
<td>1</td>
<td>0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6512</td>
<td>C581406</td>
<td>2019-12-08</td>
<td>46000S</td>
<td>Polyester Filler Pad 40x40cm</td>
<td>6.19</td>
<td>-300</td>
<td>NaN</td>
<td>United Kingdom</td>
<td>12</td>
<td>6</td>
<td>Sunday</td>
<td>8</td>
<td>-1857.00</td>
<td>1</td>
<td>1</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">90098</td>
<td>C575153</td>
<td>2019-11-08</td>
<td>22947</td>
<td>Wooden Advent Calendar Red</td>
<td>44.25</td>
<td>-1</td>
<td>NaN</td>
<td>United Kingdom</td>
<td>11</td>
<td>4</td>
<td>Friday</td>
<td>8</td>
<td>-44.25</td>
<td>1</td>
<td>0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">102671</td>
<td>C574288</td>
<td>2019-11-03</td>
<td>22178</td>
<td>Victorian Glass Hanging T-Light</td>
<td>25.37</td>
<td>-1</td>
<td>NaN</td>
<td>United Kingdom</td>
<td>11</td>
<td>6</td>
<td>Sunday</td>
<td>3</td>
<td>-25.37</td>
<td>1</td>
<td>0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">117263</td>
<td>C573180</td>
<td>2019-10-28</td>
<td>23048</td>
<td>Set Of 10 Lanterns Fairy Light Star</td>
<td>14.50</td>
<td>-1</td>
<td>NaN</td>
<td>United Kingdom</td>
<td>10</td>
<td>0</td>
<td>Monday</td>
<td>28</td>
<td>-14.50</td>
<td>1</td>
<td>0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2023-04-02T18:30:37.704741Z&quot;,&quot;start_time&quot;:&quot;2023-04-02T18:30:32.983646Z&quot;}" data-execution_count="13">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>nulls[<span class="st">'Return'</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>Return
1    54
0     1
Name: count, dtype: int64</code></pre>
</div>
</div>
<p>Only <code>CustomerNo</code> variable has null values. They are most probably due to mistakes in data collection.</p>
</section>
<section id="sales-analysis" class="level1">
<h1>Sales analysis</h1>
<p>We will now be analyzing online sales data from a one-year period spanning from 2018-12-01 to 2019-11-30. The first type of analysis will focus on the temporal aspect of the data. This analysis aims to understand the sales evolution over time, as well as identify trends within months and weeks. The second type of analysis will center around examining the regional spread of sales in order to evaluate the existing market segmentation and gain insights into potential opportunities.</p>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2023-04-02T18:30:37.756699Z&quot;,&quot;start_time&quot;:&quot;2023-04-02T18:30:33.007675Z&quot;}" data-execution_count="14">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subsetting for one exact year</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[df[<span class="st">'Date'</span>] <span class="op">&lt;=</span> <span class="st">'2019-11-30'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="monthly-evolution" class="level2">
<h2 class="anchored" data-anchor-id="monthly-evolution">Monthly evolution</h2>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2023-04-02T18:30:38.158235Z&quot;,&quot;start_time&quot;:&quot;2023-04-02T18:30:33.020896Z&quot;}" data-execution_count="15">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>month_evo <span class="op">=</span> df.groupby(pd.Grouper(key<span class="op">=</span><span class="st">'Date'</span>, freq<span class="op">=</span><span class="st">'M'</span>)).agg(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    sold<span class="op">=</span>(<span class="st">'Amount'</span>,<span class="st">'sum'</span>), returned<span class="op">=</span>(<span class="st">'Amount'</span>, <span class="kw">lambda</span> x: <span class="bu">sum</span>(x[x <span class="op">&lt;</span> <span class="dv">0</span>])),</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    nunique<span class="op">=</span>(<span class="st">'TransactionNo'</span>, <span class="st">'nunique'</span>))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>month_evo[<span class="st">'sold_moving_avg'</span>] <span class="op">=</span> month_evo[<span class="st">'sold'</span>].rolling(window<span class="op">=</span><span class="dv">3</span>).mean()</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>month_evo[<span class="st">'returned'</span>] <span class="op">=</span> month_evo[<span class="st">'returned'</span>].<span class="bu">abs</span>()</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>month_evo.index <span class="op">=</span> month_evo.index.date</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>month_evo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">sold</th>
<th data-quarto-table-cell-role="th">returned</th>
<th data-quarto-table-cell-role="th">nunique</th>
<th data-quarto-table-cell-role="th">sold_moving_avg</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-12-31</td>
<td>4234147.48</td>
<td>181268.04</td>
<td>1852</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019-01-31</td>
<td>3649506.42</td>
<td>910349.95</td>
<td>1327</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019-02-28</td>
<td>3299537.56</td>
<td>35479.62</td>
<td>1287</td>
<td>3.727730e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019-03-31</td>
<td>4353308.78</td>
<td>45092.82</td>
<td>1722</td>
<td>3.767451e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019-04-30</td>
<td>3416109.24</td>
<td>173388.64</td>
<td>1455</td>
<td>3.689652e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019-05-31</td>
<td>4530850.36</td>
<td>48114.72</td>
<td>1938</td>
<td>4.100089e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019-06-30</td>
<td>4410422.29</td>
<td>84308.52</td>
<td>1826</td>
<td>4.119127e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019-07-31</td>
<td>4518347.92</td>
<td>75519.14</td>
<td>1687</td>
<td>4.486540e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019-08-31</td>
<td>4614243.55</td>
<td>144112.47</td>
<td>1581</td>
<td>4.514338e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019-09-30</td>
<td>6542706.30</td>
<td>85596.76</td>
<td>2117</td>
<td>5.225099e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019-10-31</td>
<td>6971407.82</td>
<td>266009.54</td>
<td>2312</td>
<td>6.042786e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2019-11-30</td>
<td>7745257.92</td>
<td>115939.20</td>
<td>3146</td>
<td>7.086457e+06</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2023-04-02T18:30:38.170762Z&quot;,&quot;start_time&quot;:&quot;2023-04-02T18:30:33.021061Z&quot;}" data-execution_count="16">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>month_evo_sum <span class="op">=</span> month_evo[[<span class="st">'sold'</span>, <span class="st">'returned'</span>]].<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>month_evo_pct <span class="op">=</span> month_evo[[<span class="st">'sold'</span>, <span class="st">'returned'</span>]].div(month_evo_sum, axis<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2023-04-02T18:30:38.754106Z&quot;,&quot;start_time&quot;:&quot;2023-04-02T18:30:33.021129Z&quot;}" data-execution_count="17">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">10</span>))</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>month_evo[[<span class="st">'sold'</span>, <span class="st">'returned'</span>]].plot.bar(ax<span class="op">=</span>ax[<span class="dv">0</span>])</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_ylabel(<span class="st">'Revenue (GBP)'</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xlabel(<span class="st">'Month'</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_title(<span class="st">"Monthly evolution of sales and returns"</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].grid(axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>month_evo_pct.plot.bar(stacked<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>ax[<span class="dv">1</span>])</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_ylabel(<span class="st">'Percentage'</span>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_xlabel(<span class="st">'Month'</span>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_title(<span class="st">"Monthly relative amounts of sold and returned"</span>)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].grid(axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(hspace<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="e-commerce-analytics_files/figure-html/cell-18-output-1.png" width="1184" height="883"></p>
</div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2023-04-02T18:30:39.634876Z&quot;,&quot;start_time&quot;:&quot;2023-04-02T18:30:33.021185Z&quot;}" data-execution_count="18">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>fig, ax1 <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">5</span>))</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> plt.twinx()</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>ax1.plot(month_evo.index, month_evo[<span class="st">'sold'</span>], label<span class="op">=</span><span class="st">'Revenue'</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>ax1.plot(month_evo.index, month_evo[<span class="st">'sold_moving_avg'</span>], label<span class="op">=</span><span class="st">'3-month revenue moving average'</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>ax2.bar(month_evo.index, month_evo[<span class="st">'nunique'</span>], width<span class="op">=</span><span class="dv">8</span>, label<span class="op">=</span><span class="st">'Volume'</span>, alpha<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'Revenue (GBP)'</span>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'Volume'</span>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'Month'</span>)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Monthly evolution of sales"</span>)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>ax1.legend(loc<span class="op">=</span>(<span class="fl">0.025</span>,<span class="fl">0.85</span>))</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>ax2.legend(loc<span class="op">=</span>(<span class="fl">0.3</span>,<span class="fl">0.85</span>))</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="e-commerce-analytics_files/figure-html/cell-19-output-1.png" width="1233" height="449"></p>
</div>
</div>
</section>
<section id="intra-month-analysis" class="level2">
<h2 class="anchored" data-anchor-id="intra-month-analysis">Intra-month analysis</h2>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2023-04-02T18:30:39.833511Z&quot;,&quot;start_time&quot;:&quot;2023-04-02T18:30:33.036535Z&quot;}" data-execution_count="19">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[df[<span class="st">'Quantity'</span>] <span class="op">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>bydate <span class="op">=</span> df.groupby(<span class="st">'Date'</span>).agg(</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    UniqueTransactions<span class="op">=</span>(<span class="st">'TransactionNo'</span>, <span class="st">'nunique'</span>),</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    UniqueProdSold<span class="op">=</span>(<span class="st">'TransactionNo'</span>, <span class="st">'count'</span>),</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    ProdSold<span class="op">=</span>(<span class="st">'Quantity'</span>, <span class="st">'sum'</span>),</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    Revenue<span class="op">=</span>(<span class="st">'Amount'</span>, <span class="st">'sum'</span>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    ).reset_index()</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>bydate[<span class="st">'Day'</span>] <span class="op">=</span> bydate[<span class="st">'Date'</span>].dt.day</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>bydate[<span class="st">'Weekday'</span>] <span class="op">=</span> bydate[<span class="st">'Date'</span>].dt.weekday</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>bydate[<span class="st">'Month'</span>] <span class="op">=</span> bydate[<span class="st">'Date'</span>].dt.month</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>bydate[<span class="st">'WeekdayName'</span>] <span class="op">=</span> bydate[<span class="st">'Date'</span>].dt.day_name()</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>bydate</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th">UniqueTransactions</th>
<th data-quarto-table-cell-role="th">UniqueProdSold</th>
<th data-quarto-table-cell-role="th">ProdSold</th>
<th data-quarto-table-cell-role="th">Revenue</th>
<th data-quarto-table-cell-role="th">Day</th>
<th data-quarto-table-cell-role="th">Weekday</th>
<th data-quarto-table-cell-role="th">Month</th>
<th data-quarto-table-cell-role="th">WeekdayName</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2018-12-01</td>
<td>127</td>
<td>3061</td>
<td>26889</td>
<td>326820.08</td>
<td>1</td>
<td>5</td>
<td>12</td>
<td>Saturday</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2018-12-02</td>
<td>141</td>
<td>2057</td>
<td>31297</td>
<td>367316.62</td>
<td>2</td>
<td>6</td>
<td>12</td>
<td>Sunday</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2018-12-03</td>
<td>68</td>
<td>2136</td>
<td>16164</td>
<td>206313.62</td>
<td>3</td>
<td>0</td>
<td>12</td>
<td>Monday</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2018-12-05</td>
<td>88</td>
<td>2694</td>
<td>16357</td>
<td>197565.27</td>
<td>5</td>
<td>2</td>
<td>12</td>
<td>Wednesday</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2018-12-06</td>
<td>103</td>
<td>3823</td>
<td>21867</td>
<td>273420.10</td>
<td>6</td>
<td>3</td>
<td>12</td>
<td>Thursday</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">292</td>
<td>2019-11-25</td>
<td>84</td>
<td>3073</td>
<td>31504</td>
<td>197883.43</td>
<td>25</td>
<td>0</td>
<td>11</td>
<td>Monday</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">293</td>
<td>2019-11-27</td>
<td>57</td>
<td>2529</td>
<td>11151</td>
<td>71166.89</td>
<td>27</td>
<td>2</td>
<td>11</td>
<td>Wednesday</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">294</td>
<td>2019-11-28</td>
<td>114</td>
<td>3293</td>
<td>29440</td>
<td>190534.34</td>
<td>28</td>
<td>3</td>
<td>11</td>
<td>Thursday</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">295</td>
<td>2019-11-29</td>
<td>135</td>
<td>4275</td>
<td>30872</td>
<td>200962.48</td>
<td>29</td>
<td>4</td>
<td>11</td>
<td>Friday</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">296</td>
<td>2019-11-30</td>
<td>108</td>
<td>3337</td>
<td>28369</td>
<td>182968.22</td>
<td>30</td>
<td>5</td>
<td>11</td>
<td>Saturday</td>
</tr>
</tbody>
</table>

<p>297 rows × 9 columns</p>
</div>
</div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2023-04-02T18:30:39.845687Z&quot;,&quot;start_time&quot;:&quot;2023-04-02T18:30:33.036737Z&quot;}" data-execution_count="20">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>byday <span class="op">=</span> bydate.groupby(<span class="st">'Day'</span>)[[<span class="st">'UniqueTransactions'</span>, <span class="st">'UniqueProdSold'</span>, <span class="st">'ProdSold'</span>, <span class="st">'Revenue'</span>]].mean()</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>byday.columns <span class="op">=</span> [<span class="st">'DailyAvgUniqueTransactions'</span>, <span class="st">'DailyAvgUniqueProdSold'</span>, <span class="st">'DailyAvgProdSold'</span>, <span class="st">'DailyAvgRev'</span>]</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>byday <span class="op">=</span> byday.sort_index()</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>byday.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DailyAvgUniqueTransactions</th>
<th data-quarto-table-cell-role="th">DailyAvgUniqueProdSold</th>
<th data-quarto-table-cell-role="th">DailyAvgProdSold</th>
<th data-quarto-table-cell-role="th">DailyAvgRev</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Day</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>62.200</td>
<td>1425.600000</td>
<td>15170.000000</td>
<td>176053.439000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>66.875</td>
<td>1685.625000</td>
<td>16904.750000</td>
<td>197402.811250</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>54.700</td>
<td>1410.100000</td>
<td>15707.800000</td>
<td>188742.753000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>61.400</td>
<td>1713.100000</td>
<td>19456.500000</td>
<td>226897.317000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>71.000</td>
<td>1815.111111</td>
<td>20756.666667</td>
<td>238868.772222</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2023-04-02T18:30:40.256555Z&quot;,&quot;start_time&quot;:&quot;2023-04-02T18:30:33.036798Z&quot;}" data-execution_count="21">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>rev_coefficients <span class="op">=</span> np.polyfit(byday.index.values, byday[<span class="st">'DailyAvgRev'</span>].values, <span class="dv">5</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>rev_regression_line <span class="op">=</span> np.poly1d(rev_coefficients)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>fig, ax1 <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">5</span>))</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> plt.twinx()</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>ax2.plot(byday.index, byday[<span class="st">'DailyAvgRev'</span>], label<span class="op">=</span><span class="st">'Daily average revenue'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>ax1.bar(byday.index, byday[<span class="st">'DailyAvgUniqueTransactions'</span>], label<span class="op">=</span><span class="st">'Daily average unique transactions'</span>, alpha<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>ax2.plot(rev_regression_line(byday.index.values), label<span class="op">=</span><span class="st">'Regression line'</span>)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>ax2.axhline(byday[<span class="st">'DailyAvgRev'</span>].mean(), color<span class="op">=</span><span class="st">'b'</span>, linestyle<span class="op">=</span><span class="st">'dashed'</span>, linewidth<span class="op">=</span><span class="dv">1</span>, label<span class="op">=</span><span class="st">'Monthly average'</span>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'N. transactions'</span>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'Revenue (GBP)'</span>)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Intra-month sales analysis"</span>)</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>ax1.legend(loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'Day'</span>)</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>ax2.legend()</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="e-commerce-analytics_files/figure-html/cell-22-output-1.png" width="1258" height="449"></p>
</div>
</div>
<p>By analyzing the revenue data within a month, we can observe that the daily average revenue varies throughout the month. The revenue reaches its peak at around three-quarters of the month and dips to its lowest point just before the end of the month. However, it starts to increase again just before the last few days. The dip in revenue just before the end of the month is considered normal as it coincides with the time when people typically receive their salaries.</p>
</section>
<section id="intra-week-analysis" class="level2">
<h2 class="anchored" data-anchor-id="intra-week-analysis">Intra-week analysis</h2>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2023-04-02T18:30:40.272884Z&quot;,&quot;start_time&quot;:&quot;2023-04-02T18:30:33.063239Z&quot;}" data-execution_count="22">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>byweekday <span class="op">=</span> bydate.groupby([<span class="st">'Weekday'</span>, <span class="st">'WeekdayName'</span>])[[<span class="st">'UniqueTransactions'</span>, <span class="st">'UniqueProdSold'</span>, <span class="st">'ProdSold'</span>, <span class="st">'Revenue'</span>]].mean()</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>byweekday.columns <span class="op">=</span> [<span class="st">'DailyAvgUniqueTransactions'</span>, <span class="st">'DailyAvgUniqueProdSold'</span>, <span class="st">'DailyAvgProdSold'</span>, <span class="st">'DailyAvgRev'</span>]</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>byweekday <span class="op">=</span> byweekday.reset_index().set_index(<span class="st">'Weekday'</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>byweekday.index <span class="op">=</span> byweekday.index <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>byweekday</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">WeekdayName</th>
<th data-quarto-table-cell-role="th">DailyAvgUniqueTransactions</th>
<th data-quarto-table-cell-role="th">DailyAvgUniqueProdSold</th>
<th data-quarto-table-cell-role="th">DailyAvgProdSold</th>
<th data-quarto-table-cell-role="th">DailyAvgRev</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Weekday</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>Monday</td>
<td>61.416667</td>
<td>1570.854167</td>
<td>16290.958333</td>
<td>187875.265208</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Wednesday</td>
<td>43.612245</td>
<td>1259.551020</td>
<td>9342.183673</td>
<td>107400.393061</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Thursday</td>
<td>64.217391</td>
<td>1900.000000</td>
<td>17979.391304</td>
<td>208483.595435</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Friday</td>
<td>66.705882</td>
<td>1879.764706</td>
<td>21235.274510</td>
<td>245216.874706</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Saturday</td>
<td>68.500000</td>
<td>1721.365385</td>
<td>18900.384615</td>
<td>210759.228077</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Sunday</td>
<td>77.843137</td>
<td>1820.686275</td>
<td>22464.431373</td>
<td>257149.160980</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2023-04-02T18:30:40.671720Z&quot;,&quot;start_time&quot;:&quot;2023-04-02T18:30:33.063457Z&quot;}" data-execution_count="23">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>rev_coefficients <span class="op">=</span> np.polyfit(byweekday.index.values, byweekday[<span class="st">'DailyAvgRev'</span>].values, <span class="dv">2</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>rev_regression_line <span class="op">=</span> np.poly1d(rev_coefficients)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>fig, ax1 <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">5</span>))</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> plt.twinx()</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>ax2.plot(byweekday[<span class="st">'WeekdayName'</span>], byweekday[<span class="st">'DailyAvgRev'</span>], label<span class="op">=</span><span class="st">'Daily average revenue'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>ax1.bar(byweekday[<span class="st">'WeekdayName'</span>], byweekday[<span class="st">'DailyAvgUniqueTransactions'</span>], label<span class="op">=</span><span class="st">'Daily average unique transactions'</span>, alpha<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>ax2.plot(rev_regression_line(byweekday.index.values), label<span class="op">=</span><span class="st">'Regression line'</span>)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>ax2.axhline(byweekday[<span class="st">'DailyAvgRev'</span>].mean(), color<span class="op">=</span><span class="st">'b'</span>, linestyle<span class="op">=</span><span class="st">'dashed'</span>, linewidth<span class="op">=</span><span class="dv">1</span>, label<span class="op">=</span><span class="st">'Weekly average'</span>)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'N. transactions'</span>)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'Revenue(GBP)'</span>)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Intra-week sales analysis"</span>)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>plt.grid(axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>ax1.legend(loc<span class="op">=</span><span class="st">'lower left'</span>)</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'Weekday'</span>)</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>ax2.legend()</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="e-commerce-analytics_files/figure-html/cell-24-output-1.png" width="1258" height="449"></p>
</div>
</div>
<p>Similar to the analysis conducted within a month, examining sales patterns within a week can also reveal interesting insights. By looking at the graph above, it becomes evident that the sales volume and revenue significantly increase during the latter part of the week. Specifically, revenue exceeds the weekly average starting from Thursday. On the other hand, Wednesday remains the least profitable day of the week with the lowest sales volume and revenue.</p>
</section>
<section id="geographical-analysis" class="level2">
<h2 class="anchored" data-anchor-id="geographical-analysis">Geographical analysis</h2>
<p>When conducting a geographical analysis of sales, it is essential to consider both the average purchase value and sales volume to determine if there are any countries that offer promising opportunities. For instance, a country with a high average purchase value but low sales volume may indicate that it has untapped potential and should be targeted for further penetration. The average purchase value gives an indication of the buying power and willingness of customers to spend money, while sales volume reflects the market demand and potential for growth. A country with a high average purchase value and low sales volume could be a potential opportunity for businesses to capitalize on the untapped market potential by increasing their presence and promoting their products or services more effectively.</p>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2023-04-02T18:30:40.824045Z&quot;,&quot;start_time&quot;:&quot;2023-04-02T18:30:33.088723Z&quot;}" data-execution_count="24">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapping regions</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>regions <span class="op">=</span> {<span class="st">'Europe'</span>: [<span class="st">'Sweden'</span>, <span class="st">'Denmark'</span>, <span class="st">'Norway'</span>, <span class="st">'Finland'</span>, <span class="st">'Iceland'</span>, <span class="st">'Netherlands'</span>, <span class="st">'Belgium'</span>, <span class="st">'France'</span>, <span class="st">'Germany'</span>, <span class="st">'Switzerland'</span>, <span class="st">'Austria'</span>,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'Italy'</span>, <span class="st">'Spain'</span>, <span class="st">'Greece'</span>, <span class="st">'Portugal'</span>, <span class="st">'Malta'</span>, <span class="st">'Cyprus'</span>, <span class="st">'Czech Republic'</span>, <span class="st">'Lithuania'</span>, <span class="st">'Poland'</span>, <span class="st">'United Kingdom'</span>, <span class="st">'EIRE'</span>,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'Channel Islands'</span>, <span class="st">'European Community'</span>],</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>           <span class="st">'North America'</span>: [<span class="st">'USA'</span>, <span class="st">'Canada'</span>],</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>           <span class="st">'Middle East'</span>: [<span class="st">'Bahrain'</span>, <span class="st">'United Arab Emirates'</span>, <span class="st">'Israel'</span>, <span class="st">'Lebanon'</span>, <span class="st">'Saudi Arabia'</span>],</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>           <span class="st">'Asia Pacific'</span>: [<span class="st">'Japan'</span>, <span class="st">'Australia'</span>, <span class="st">'Singapore'</span>, <span class="st">'Hong Kong'</span>],</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>           <span class="st">'RoW'</span>: [<span class="st">'Brazil'</span>, <span class="st">'RSA'</span>],</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>           <span class="st">'Unspecified'</span>: [<span class="st">'Unspecified'</span>]}</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>country_to_region <span class="op">=</span> {}</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> region, countries <span class="kw">in</span> regions.items():</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> country <span class="kw">in</span> countries:</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>        country_to_region[country] <span class="op">=</span> region</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Region'</span>] <span class="op">=</span> df[<span class="st">'Country'</span>].<span class="bu">map</span>(country_to_region)</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'UKvsRoW'</span>] <span class="op">=</span> np.where(df[<span class="st">'Country'</span>] <span class="op">==</span> <span class="st">'United Kingdom'</span>, <span class="st">'UK'</span>, <span class="st">'RoW'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2023-04-02T18:30:40.888654Z&quot;,&quot;start_time&quot;:&quot;2023-04-02T18:30:33.089011Z&quot;}" data-execution_count="25">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>bycountry <span class="op">=</span> df.groupby(<span class="st">'Country'</span>).agg(</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    tot_amount<span class="op">=</span>(<span class="st">'Amount'</span>, <span class="st">'sum'</span>),</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    mean_amount<span class="op">=</span>(<span class="st">'Amount'</span>, <span class="st">'mean'</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>).sort_values(<span class="st">'tot_amount'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>bycountry.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">tot_amount</th>
<th data-quarto-table-cell-role="th">mean_amount</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Country</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">United Kingdom</td>
<td>50192562.28</td>
<td>110.502027</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Netherlands</td>
<td>2101104.07</td>
<td>937.992888</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">EIRE</td>
<td>1687318.68</td>
<td>225.607525</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Germany</td>
<td>1346540.40</td>
<td>135.494103</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">France</td>
<td>1306661.68</td>
<td>129.564867</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2023-04-02T18:30:42.036360Z&quot;,&quot;start_time&quot;:&quot;2023-04-02T18:30:33.089149Z&quot;}" data-execution_count="26">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">10</span>))</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].bar(bycountry.index, bycountry[<span class="st">'tot_amount'</span>])</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].bar(bycountry.sort_values(<span class="st">'mean_amount'</span>, ascending<span class="op">=</span><span class="va">False</span>).index, bycountry.sort_values(<span class="st">'mean_amount'</span>, ascending<span class="op">=</span><span class="va">False</span>)[<span class="st">'mean_amount'</span>])</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>plt.setp(ax, xticks<span class="op">=</span>bycountry.index, xticklabels<span class="op">=</span>bycountry.index)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>plt.setp(ax[<span class="dv">0</span>].get_xticklabels(), rotation<span class="op">=</span><span class="dv">90</span>, ha<span class="op">=</span><span class="st">"center"</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>plt.setp(ax[<span class="dv">1</span>].get_xticklabels(), rotation<span class="op">=</span><span class="dv">90</span>, ha<span class="op">=</span><span class="st">"center"</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_ylabel(<span class="st">"Amount (GBP)"</span>)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_ylabel(<span class="st">"Amount (GBP)"</span>)</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_title(<span class="st">"Countries by total amount sold"</span>)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_title(<span class="st">"Countries by average amount sold"</span>)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">"Overview on geographical market spread"</span>)</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].grid(axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].grid(axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(hspace<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="e-commerce-analytics_files/figure-html/cell-27-output-1.png" width="1197" height="1008"></p>
</div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2023-04-02T18:30:42.180659Z&quot;,&quot;start_time&quot;:&quot;2023-04-02T18:30:33.089242Z&quot;}" data-execution_count="27">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>byukvsrow <span class="op">=</span> df.groupby(<span class="st">'UKvsRoW'</span>).agg(</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    tot_amount<span class="op">=</span>(<span class="st">'Amount'</span>, <span class="st">'sum'</span>),</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    mean_amount<span class="op">=</span>(<span class="st">'Amount'</span>, <span class="st">'mean'</span>),</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    n_inv<span class="op">=</span>(<span class="st">'TransactionNo'</span>, <span class="st">'nunique'</span>),</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    quantity<span class="op">=</span>(<span class="st">'Quantity'</span>, <span class="st">'mean'</span>)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>).sort_values(<span class="st">'mean_amount'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>byukvsrow</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">tot_amount</th>
<th data-quarto-table-cell-role="th">mean_amount</th>
<th data-quarto-table-cell-role="th">n_inv</th>
<th data-quarto-table-cell-role="th">quantity</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">UKvsRoW</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">RoW</td>
<td>10258462.78</td>
<td>211.383944</td>
<td>1809</td>
<td>18.478900</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">UK</td>
<td>50192562.28</td>
<td>110.502027</td>
<td>17164</td>
<td>9.646163</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2023-04-02T18:30:42.341127Z&quot;,&quot;start_time&quot;:&quot;2023-04-02T18:30:33.089334Z&quot;}" data-execution_count="28">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>plt.pie(byukvsrow[<span class="st">'tot_amount'</span>], labels<span class="op">=</span>byukvsrow.index, autopct<span class="op">=</span><span class="st">'</span><span class="sc">%1.1f%%</span><span class="st">'</span>, explode<span class="op">=</span>(<span class="fl">0.1</span>,<span class="dv">0</span>), shadow<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Total revenue by UK vs other countries'</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="e-commerce-analytics_files/figure-html/cell-29-output-1.png" width="389" height="409"></p>
</div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2023-04-02T18:30:42.475006Z&quot;,&quot;start_time&quot;:&quot;2023-04-02T18:30:33.089420Z&quot;}" data-execution_count="29">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>row_rev <span class="op">=</span> df.loc[df[<span class="st">'UKvsRoW'</span>] <span class="op">==</span> <span class="st">'RoW'</span>, <span class="st">'Amount'</span>]</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>uk_rev <span class="op">=</span> df.loc[df[<span class="st">'UKvsRoW'</span>] <span class="op">==</span> <span class="st">'UK'</span>, <span class="st">'Amount'</span>]</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>ttest_ind(uk_rev, row_rev)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>Ttest_indResult(statistic=-16.7279858606087, pvalue=8.524026769071223e-63)</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Even though the volume of sales of international customers accounts only for the 17.0%, the <strong>average revenue generated abroad is significantly higher than the one generated in the UK</strong>. This means that international markets for this business are potentially more lucrative than the national one and need to be exploited more.</p>
</blockquote>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2023-04-02T18:30:42.613739Z&quot;,&quot;start_time&quot;:&quot;2023-04-02T18:30:33.106391Z&quot;}" data-execution_count="30">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>byregion <span class="op">=</span> df.groupby(<span class="st">'Region'</span>).agg(</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    tot_amount<span class="op">=</span>(<span class="st">'Amount'</span>, <span class="st">'sum'</span>),</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    mean_amount<span class="op">=</span>(<span class="st">'Amount'</span>, <span class="st">'mean'</span>),</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    n_inv<span class="op">=</span>(<span class="st">'TransactionNo'</span>, <span class="st">'nunique'</span>),</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    quantity<span class="op">=</span>(<span class="st">'Quantity'</span>, <span class="st">'mean'</span>)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>).sort_values(<span class="st">'mean_amount'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>byregion.sort_values(<span class="st">'mean_amount'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">tot_amount</th>
<th data-quarto-table-cell-role="th">mean_amount</th>
<th data-quarto-table-cell-role="th">n_inv</th>
<th data-quarto-table-cell-role="th">quantity</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Region</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Asia Pacific</td>
<td>1380079.80</td>
<td>590.787586</td>
<td>92</td>
<td>51.083904</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">North America</td>
<td>59633.28</td>
<td>154.891636</td>
<td>11</td>
<td>13.503896</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Middle East</td>
<td>76798.30</td>
<td>154.835282</td>
<td>16</td>
<td>12.661290</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Europe</td>
<td>58892902.53</td>
<td>118.021612</td>
<td>18839</td>
<td>10.308538</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">RoW</td>
<td>8912.10</td>
<td>101.273864</td>
<td>2</td>
<td>8.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Unspecified</td>
<td>32699.05</td>
<td>73.152237</td>
<td>13</td>
<td>6.272931</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2023-04-02T18:30:42.834612Z&quot;,&quot;start_time&quot;:&quot;2023-04-02T18:30:33.106571Z&quot;}" data-execution_count="31">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>fig, ax1 <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">5</span>))</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> plt.bar(byregion.index, byregion[<span class="st">'mean_amount'</span>])</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Average purchase value by region"</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Amount (GBP)'</span>)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Region'</span>)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>plt.grid(axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="e-commerce-analytics_files/figure-html/cell-32-output-1.png" width="1188" height="449"></p>
</div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2023-04-02T18:30:44.456895Z&quot;,&quot;start_time&quot;:&quot;2023-04-02T18:30:33.106638Z&quot;}" data-execution_count="32">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>f_value, p_value <span class="op">=</span> f_oneway(df.loc[df[<span class="st">'Region'</span>] <span class="op">==</span> <span class="st">'Asia Pacific'</span>, <span class="st">'Amount'</span>],</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>                            df.loc[df[<span class="st">'Region'</span>] <span class="op">==</span> <span class="st">'North America'</span>, <span class="st">'Amount'</span>],</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>                            df.loc[df[<span class="st">'Region'</span>] <span class="op">==</span> <span class="st">'Middle East'</span>, <span class="st">'Amount'</span>],</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>                            df.loc[df[<span class="st">'Region'</span>] <span class="op">==</span> <span class="st">'Europe'</span>, <span class="st">'Amount'</span>],</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>                            df.loc[df[<span class="st">'Region'</span>] <span class="op">==</span> <span class="st">'RoW'</span>, <span class="st">'Amount'</span>])</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'ANOVA F-value: </span><span class="sc">{</span>f_value<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'ANOVA p-value: </span><span class="sc">{</span>p_value<span class="sc">:.4f}</span><span class="ss">'</span>)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>tukey_df <span class="op">=</span> df.<span class="bu">filter</span>(items<span class="op">=</span>[<span class="st">'Amount'</span>, <span class="st">'Region'</span>]).dropna()</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pairwise_tukeyhsd(tukey_df[<span class="st">'Amount'</span>], tukey_df[<span class="st">'Region'</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ANOVA F-value: 81.58
ANOVA p-value: 0.0000
          Multiple Comparison of Means - Tukey HSD, FWER=0.05          
=======================================================================
    group1        group2     meandiff p-adj    lower     upper   reject
-----------------------------------------------------------------------
 Asia Pacific        Europe  -472.766    0.0 -547.3921 -398.1398   True
 Asia Pacific   Middle East -435.9523    0.0  -613.855 -258.0496   True
 Asia Pacific North America -435.8959    0.0 -633.8256 -237.9663   True
 Asia Pacific           RoW -489.5137 0.0048 -880.2663  -98.7612   True
 Asia Pacific   Unspecified -517.6353    0.0 -703.4071 -331.8636   True
       Europe   Middle East   36.8137 0.9872  -124.841  198.4683  False
       Europe North America     36.87 0.9928 -146.5938  220.3338  False
       Europe           RoW  -16.7477    1.0 -400.3757  366.8802  False
       Europe   Unspecified  -44.8694 0.9754 -215.1456  125.4068  False
  Middle East North America    0.0564    1.0 -244.3599  244.4726  False
  Middle East           RoW  -53.5614 0.9991 -469.7954  362.6726  False
  Middle East   Unspecified   -81.683 0.9207 -316.3622  152.9961  False
North America           RoW  -53.6178 0.9992 -478.7971  371.5616  False
North America   Unspecified  -81.7394 0.9386 -331.9414  168.4626  False
          RoW   Unspecified  -28.1216    1.0 -447.7792   391.536  False
-----------------------------------------------------------------------</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>We can observe from both the bar plot and the ANOVA analysis that the <strong>mean purchase value in the Asia/Pacific region is consistently and significantly higher</strong> than the mean purchase value in the other regions. Based on this important information, we can infer that the Asia/Pacific region is a potentially lucrative market with higher average purchase amounts than the other regions. Therefore, the store may want to consider investing more resources in this region to take advantage of this opportunity to increase volume of sales. The business can consider implementing targeted marketing strategies, such as advertising campaigns and promotions, that cater to the preferences and interests of the Asia/Pacific market. Additionally, it can explore expanding its product offerings to meet the specific demands of this region, or enhancing the quality of existing products to meet their higher standards. It may be useful to conduct further research and analysis to gain deeper insights into the preferences and behavior of customers in the Asia/Pacific region, and tailor sales strategies accordingly.</p>
</blockquote>
</section>
</section>
<section id="market-basket-analysis-for-the-asian-market" class="level1">
<h1>Market basket analysis for the Asian market</h1>
<p>Market basket analysis is a powerful technique in the field of data mining and business analytics that has gained significant attention in recent years. It enables businesses to understand the relationships between products and customer behavior, helping them make informed decisions about their product offerings, promotions, and pricing strategies. The technique is widely used in industries such as retail, e-commerce, and marketing, where understanding customer purchasing patterns is crucial for improving sales and profitability.</p>
<p>In market basket analysis, association rules play a central role as they describe the relationships between sets of items using if-then statements. For instance, an association rule like {razor} {shaving cream} can be interpreted as “if razor, then shaving cream,” where razor is the antecedent and shaving cream is the consequent. It is worth noting that many rules have multiple antecedents and consequents. To begin with, the first step of a market basket analysis involves extracting a unique dataframe of products and then elaborating on the association rules.</p>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2023-04-02T18:31:00.989793Z&quot;,&quot;start_time&quot;:&quot;2023-04-02T18:30:33.170680Z&quot;}" data-tags="[]" data-execution_count="33">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Converting transactions in a list of lists</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>transactions <span class="op">=</span> df.groupby(<span class="st">'TransactionNo'</span>).<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">list</span>(x[<span class="st">'ProductName'</span>])).to_list()</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>encoder <span class="op">=</span> TransactionEncoder().fit(transactions)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>onehot <span class="op">=</span> encoder.transform(transactions)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>onehot <span class="op">=</span> pd.DataFrame(onehot, columns<span class="op">=</span>encoder.columns_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>frequent_itemsets <span class="op">=</span> apriori(onehot,</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>                            min_support <span class="op">=</span> <span class="fl">0.02</span>, </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>                            max_len <span class="op">=</span> <span class="dv">5</span>, </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>                            use_colnames <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Number of itemsets selected:'</span>, <span class="bu">len</span>(frequent_itemsets))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of itemsets selected: 398</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="35">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>rules <span class="op">=</span> association_rules(frequent_itemsets, metric<span class="op">=</span><span class="st">'confidence'</span>, min_threshold<span class="op">=</span><span class="fl">0.51</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>rules[<span class="st">'n_antecedents'</span>] <span class="op">=</span> rules[<span class="st">'antecedents'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">len</span>(x))</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>rules[<span class="st">'n_consequents'</span>] <span class="op">=</span> rules[<span class="st">'consequents'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">len</span>(x))</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>rules.sort_values(<span class="st">'confidence'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">antecedents</th>
<th data-quarto-table-cell-role="th">consequents</th>
<th data-quarto-table-cell-role="th">antecedent support</th>
<th data-quarto-table-cell-role="th">consequent support</th>
<th data-quarto-table-cell-role="th">support</th>
<th data-quarto-table-cell-role="th">confidence</th>
<th data-quarto-table-cell-role="th">lift</th>
<th data-quarto-table-cell-role="th">leverage</th>
<th data-quarto-table-cell-role="th">conviction</th>
<th data-quarto-table-cell-role="th">n_antecedents</th>
<th data-quarto-table-cell-role="th">n_consequents</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">48</td>
<td>(Roses Regency Teacup And Saucer, Pink Regency...</td>
<td>(Green Regency Teacup And Saucer)</td>
<td>0.030201</td>
<td>0.051863</td>
<td>0.027355</td>
<td>0.905759</td>
<td>17.464399</td>
<td>0.025788</td>
<td>10.060785</td>
<td>2</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">49</td>
<td>(Green Regency Teacup And Saucer, Pink Regency...</td>
<td>(Roses Regency Teacup And Saucer)</td>
<td>0.032046</td>
<td>0.054446</td>
<td>0.027355</td>
<td>0.853618</td>
<td>15.678318</td>
<td>0.025610</td>
<td>6.459516</td>
<td>2</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>(Pink Regency Teacup And Saucer)</td>
<td>(Green Regency Teacup And Saucer)</td>
<td>0.038687</td>
<td>0.051863</td>
<td>0.032046</td>
<td>0.828338</td>
<td>15.971600</td>
<td>0.030039</td>
<td>5.523273</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">56</td>
<td>(Jumbo Storage Bag Suki, Jumbo Bag Pink Polkadot)</td>
<td>(Jumbo Bag Red Retrospot)</td>
<td>0.026459</td>
<td>0.107469</td>
<td>0.021293</td>
<td>0.804781</td>
<td>7.488527</td>
<td>0.018450</td>
<td>4.571947</td>
<td>2</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">54</td>
<td>(Green Regency Teacup And Saucer, Regency Cake...</td>
<td>(Roses Regency Teacup And Saucer)</td>
<td>0.025879</td>
<td>0.054446</td>
<td>0.020661</td>
<td>0.798371</td>
<td>14.663588</td>
<td>0.019252</td>
<td>4.689567</td>
<td>2</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">42</td>
<td>(Pink Regency Teacup And Saucer)</td>
<td>(Roses Regency Teacup And Saucer)</td>
<td>0.038687</td>
<td>0.054446</td>
<td>0.030201</td>
<td>0.780654</td>
<td>14.338187</td>
<td>0.028094</td>
<td>4.310788</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">53</td>
<td>(Roses Regency Teacup And Saucer, Regency Cake...</td>
<td>(Green Regency Teacup And Saucer)</td>
<td>0.026669</td>
<td>0.051863</td>
<td>0.020661</td>
<td>0.774704</td>
<td>14.937450</td>
<td>0.019278</td>
<td>4.208397</td>
<td>2</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20</td>
<td>(Green Regency Teacup And Saucer)</td>
<td>(Roses Regency Teacup And Saucer)</td>
<td>0.051863</td>
<td>0.054446</td>
<td>0.039055</td>
<td>0.753049</td>
<td>13.831166</td>
<td>0.036232</td>
<td>3.828911</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">19</td>
<td>(Roses Regency Teacup And Saucer)</td>
<td>(Green Regency Teacup And Saucer)</td>
<td>0.054446</td>
<td>0.051863</td>
<td>0.039055</td>
<td>0.717328</td>
<td>13.831166</td>
<td>0.036232</td>
<td>3.354196</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>(Gardeners Kneeling Pad Cup Of Tea)</td>
<td>(Gardeners Kneeling Pad Keep Calm)</td>
<td>0.036895</td>
<td>0.044379</td>
<td>0.026301</td>
<td>0.712857</td>
<td>16.062991</td>
<td>0.024663</td>
<td>3.328034</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">51</td>
<td>(Pink Regency Teacup And Saucer)</td>
<td>(Roses Regency Teacup And Saucer, Green Regenc...</td>
<td>0.038687</td>
<td>0.039055</td>
<td>0.027355</td>
<td>0.707084</td>
<td>18.104607</td>
<td>0.025844</td>
<td>3.280620</td>
<td>1</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">47</td>
<td>(Roses Regency Teacup And Saucer, Green Regenc...</td>
<td>(Pink Regency Teacup And Saucer)</td>
<td>0.039055</td>
<td>0.038687</td>
<td>0.027355</td>
<td>0.700405</td>
<td>18.104607</td>
<td>0.025844</td>
<td>3.208708</td>
<td>2</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>(Charlotte Bag Pink Polkadot)</td>
<td>(Red Retrospot Charlotte Bag)</td>
<td>0.038159</td>
<td>0.052865</td>
<td>0.026617</td>
<td>0.697514</td>
<td>13.194347</td>
<td>0.024599</td>
<td>3.131169</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">22</td>
<td>(Jumbo Bag Pears)</td>
<td>(Jumbo Bag Apples)</td>
<td>0.030359</td>
<td>0.049860</td>
<td>0.020766</td>
<td>0.684028</td>
<td>13.718878</td>
<td>0.019253</td>
<td>3.007035</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25</td>
<td>(Jumbo Bag Pink Polkadot)</td>
<td>(Jumbo Bag Red Retrospot)</td>
<td>0.063037</td>
<td>0.107469</td>
<td>0.042745</td>
<td>0.678094</td>
<td>6.309696</td>
<td>0.035970</td>
<td>2.772643</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27</td>
<td>(Jumbo Bag Scandinavian Blue Paisley)</td>
<td>(Jumbo Bag Red Retrospot)</td>
<td>0.041480</td>
<td>0.107469</td>
<td>0.027987</td>
<td>0.674714</td>
<td>6.278249</td>
<td>0.023529</td>
<td>2.743837</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">40</td>
<td>(Paper Chain Kit Vintage Christmas)</td>
<td>(Paper Chain Kit 50'S Christmas)</td>
<td>0.038739</td>
<td>0.055026</td>
<td>0.026037</td>
<td>0.672109</td>
<td>12.214484</td>
<td>0.023905</td>
<td>2.881976</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43</td>
<td>(Strawberry Charlotte Bag)</td>
<td>(Red Retrospot Charlotte Bag)</td>
<td>0.037000</td>
<td>0.052865</td>
<td>0.024825</td>
<td>0.670940</td>
<td>12.691673</td>
<td>0.022869</td>
<td>2.878308</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>(Red Hanging Heart T-Light Holder)</td>
<td>(Cream Hanging Heart T-Light Holder)</td>
<td>0.037263</td>
<td>0.115902</td>
<td>0.024877</td>
<td>0.667610</td>
<td>5.760144</td>
<td>0.020559</td>
<td>2.659820</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>(Jumbo Bag Strawberry)</td>
<td>(Jumbo Bag Red Retrospot)</td>
<td>0.042534</td>
<td>0.107469</td>
<td>0.027829</td>
<td>0.654275</td>
<td>6.088063</td>
<td>0.023258</td>
<td>2.581623</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>(Alarm Clock Bakelike Green)</td>
<td>(Alarm Clock Bakelike Red)</td>
<td>0.048806</td>
<td>0.052232</td>
<td>0.031413</td>
<td>0.643629</td>
<td>12.322466</td>
<td>0.028864</td>
<td>2.659494</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">24</td>
<td>(Jumbo Bag Baroque Black White)</td>
<td>(Jumbo Bag Red Retrospot)</td>
<td>0.047489</td>
<td>0.107469</td>
<td>0.029885</td>
<td>0.629301</td>
<td>5.855676</td>
<td>0.024781</td>
<td>2.407697</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>(Jumbo Bag Spaceboy Design)</td>
<td>(Jumbo Bag Red Retrospot)</td>
<td>0.035155</td>
<td>0.107469</td>
<td>0.022084</td>
<td>0.628186</td>
<td>5.845302</td>
<td>0.018306</td>
<td>2.400478</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>(Dolly Girl Lunch Box)</td>
<td>(Spaceboy Lunch Box)</td>
<td>0.043430</td>
<td>0.045591</td>
<td>0.027249</td>
<td>0.627427</td>
<td>13.762053</td>
<td>0.025269</td>
<td>2.561671</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30</td>
<td>(Jumbo Bag Woodland Animals)</td>
<td>(Jumbo Bag Red Retrospot)</td>
<td>0.044115</td>
<td>0.107469</td>
<td>0.027355</td>
<td>0.620072</td>
<td>5.769799</td>
<td>0.022614</td>
<td>2.349210</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>(Green Regency Teacup And Saucer)</td>
<td>(Pink Regency Teacup And Saucer)</td>
<td>0.051863</td>
<td>0.038687</td>
<td>0.032046</td>
<td>0.617886</td>
<td>15.971600</td>
<td>0.030039</td>
<td>2.515778</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">33</td>
<td>(Jumbo Storage Bag Suki)</td>
<td>(Jumbo Bag Red Retrospot)</td>
<td>0.060507</td>
<td>0.107469</td>
<td>0.036895</td>
<td>0.609756</td>
<td>5.673812</td>
<td>0.030392</td>
<td>2.287112</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">44</td>
<td>(Woodland Charlotte Bag)</td>
<td>(Red Retrospot Charlotte Bag)</td>
<td>0.042587</td>
<td>0.052865</td>
<td>0.025773</td>
<td>0.605198</td>
<td>11.448078</td>
<td>0.023522</td>
<td>2.399014</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26</td>
<td>(Jumbo Bag Pink Vintage Paisley)</td>
<td>(Jumbo Bag Red Retrospot)</td>
<td>0.044432</td>
<td>0.107469</td>
<td>0.026828</td>
<td>0.603796</td>
<td>5.618353</td>
<td>0.022053</td>
<td>2.252707</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>(Alarm Clock Bakelike Pink)</td>
<td>(Alarm Clock Bakelike Red)</td>
<td>0.039424</td>
<td>0.052232</td>
<td>0.023718</td>
<td>0.601604</td>
<td>11.517899</td>
<td>0.021659</td>
<td>2.378961</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>(Alarm Clock Bakelike Red)</td>
<td>(Alarm Clock Bakelike Green)</td>
<td>0.052232</td>
<td>0.048806</td>
<td>0.031413</td>
<td>0.601413</td>
<td>12.322466</td>
<td>0.028864</td>
<td>2.386413</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">14</td>
<td>(Spaceboy Lunch Box)</td>
<td>(Dolly Girl Lunch Box)</td>
<td>0.045591</td>
<td>0.043430</td>
<td>0.027249</td>
<td>0.597688</td>
<td>13.762053</td>
<td>0.025269</td>
<td>2.377681</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">35</td>
<td>(Jumbo Bag Vintage Leaf)</td>
<td>(Jumbo Bag Vintage Doily)</td>
<td>0.044326</td>
<td>0.062563</td>
<td>0.026301</td>
<td>0.593341</td>
<td>9.483963</td>
<td>0.023527</td>
<td>2.305219</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">16</td>
<td>(Gardeners Kneeling Pad Keep Calm)</td>
<td>(Gardeners Kneeling Pad Cup Of Tea)</td>
<td>0.044379</td>
<td>0.036895</td>
<td>0.026301</td>
<td>0.592637</td>
<td>16.062991</td>
<td>0.024663</td>
<td>2.364241</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32</td>
<td>(Jumbo Storage Bag Skulls)</td>
<td>(Jumbo Bag Red Retrospot)</td>
<td>0.035630</td>
<td>0.107469</td>
<td>0.021083</td>
<td>0.591716</td>
<td>5.505948</td>
<td>0.017254</td>
<td>2.186055</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31</td>
<td>(Jumbo Shopper Vintage Red Paisley)</td>
<td>(Jumbo Bag Red Retrospot)</td>
<td>0.059875</td>
<td>0.107469</td>
<td>0.034734</td>
<td>0.580106</td>
<td>5.397913</td>
<td>0.028299</td>
<td>2.125610</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">55</td>
<td>(Jumbo Bag Red Retrospot, Jumbo Storage Bag Suki)</td>
<td>(Jumbo Bag Pink Polkadot)</td>
<td>0.036895</td>
<td>0.063037</td>
<td>0.021293</td>
<td>0.577143</td>
<td>9.155628</td>
<td>0.018968</td>
<td>2.215791</td>
<td>2</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>(Charlotte Bag Suki Design)</td>
<td>(Red Retrospot Charlotte Bag)</td>
<td>0.045011</td>
<td>0.052865</td>
<td>0.025826</td>
<td>0.573770</td>
<td>10.853587</td>
<td>0.023447</td>
<td>2.222125</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>(Strawberry Charlotte Bag)</td>
<td>(Charlotte Bag Suki Design)</td>
<td>0.037000</td>
<td>0.045011</td>
<td>0.021083</td>
<td>0.569801</td>
<td>12.659047</td>
<td>0.019417</td>
<td>2.219874</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>(Jumbo Bag Apples)</td>
<td>(Jumbo Bag Red Retrospot)</td>
<td>0.049860</td>
<td>0.107469</td>
<td>0.028093</td>
<td>0.563425</td>
<td>5.242698</td>
<td>0.022734</td>
<td>2.044394</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">45</td>
<td>(Strawberry Charlotte Bag)</td>
<td>(Woodland Charlotte Bag)</td>
<td>0.037000</td>
<td>0.042587</td>
<td>0.020608</td>
<td>0.556980</td>
<td>13.078691</td>
<td>0.019033</td>
<td>2.161106</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">37</td>
<td>(Lunch Bag Pink Polkadot)</td>
<td>(Lunch Bag Red Retrospot)</td>
<td>0.056080</td>
<td>0.080272</td>
<td>0.031202</td>
<td>0.556391</td>
<td>6.931324</td>
<td>0.026701</td>
<td>2.073285</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">34</td>
<td>(Recycling Bag Retrospot)</td>
<td>(Jumbo Bag Red Retrospot)</td>
<td>0.038212</td>
<td>0.107469</td>
<td>0.021241</td>
<td>0.555862</td>
<td>5.172325</td>
<td>0.017134</td>
<td>2.009582</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">41</td>
<td>(Roses Regency Teacup And Saucer)</td>
<td>(Pink Regency Teacup And Saucer)</td>
<td>0.054446</td>
<td>0.038687</td>
<td>0.030201</td>
<td>0.554695</td>
<td>14.338187</td>
<td>0.028094</td>
<td>2.158776</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">46</td>
<td>(Wooden Frame Antique White)</td>
<td>(Wooden Picture Frame White Finish)</td>
<td>0.049281</td>
<td>0.056449</td>
<td>0.027302</td>
<td>0.554011</td>
<td>9.814421</td>
<td>0.024520</td>
<td>2.115637</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>(Charlotte Bag Pink Polkadot)</td>
<td>(Charlotte Bag Suki Design)</td>
<td>0.038159</td>
<td>0.045011</td>
<td>0.020872</td>
<td>0.546961</td>
<td>12.151636</td>
<td>0.019154</td>
<td>2.107963</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>(60 Teatime Fairy Cake Cases)</td>
<td>(Pack Of 72 Retrospot Cake Cases)</td>
<td>0.042534</td>
<td>0.067886</td>
<td>0.023244</td>
<td>0.546468</td>
<td>8.049802</td>
<td>0.020356</td>
<td>2.055235</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>(Woodland Charlotte Bag)</td>
<td>(Charlotte Bag Suki Design)</td>
<td>0.042587</td>
<td>0.045011</td>
<td>0.023085</td>
<td>0.542079</td>
<td>12.043172</td>
<td>0.021169</td>
<td>2.085489</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">21</td>
<td>(Heart Of Wicker Large)</td>
<td>(Heart Of Wicker Small)</td>
<td>0.047436</td>
<td>0.061614</td>
<td>0.025405</td>
<td>0.535556</td>
<td>8.692126</td>
<td>0.022482</td>
<td>2.020449</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>(Alarm Clock Bakelike Pink)</td>
<td>(Alarm Clock Bakelike Green)</td>
<td>0.039424</td>
<td>0.048806</td>
<td>0.020924</td>
<td>0.530749</td>
<td>10.874616</td>
<td>0.019000</td>
<td>2.027045</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">52</td>
<td>(Roses Regency Teacup And Saucer, Green Regenc...</td>
<td>(Regency Cakestand 3 Tier)</td>
<td>0.039055</td>
<td>0.101724</td>
<td>0.020661</td>
<td>0.529015</td>
<td>5.200517</td>
<td>0.016688</td>
<td>1.907229</td>
<td>2</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50</td>
<td>(Green Regency Teacup And Saucer)</td>
<td>(Roses Regency Teacup And Saucer, Pink Regency...</td>
<td>0.051863</td>
<td>0.030201</td>
<td>0.027355</td>
<td>0.527439</td>
<td>17.464399</td>
<td>0.025788</td>
<td>2.052220</td>
<td>1</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>(Charlotte Bag Pink Polkadot)</td>
<td>(Woodland Charlotte Bag)</td>
<td>0.038159</td>
<td>0.042587</td>
<td>0.020081</td>
<td>0.526243</td>
<td>12.356943</td>
<td>0.018456</td>
<td>2.020895</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">39</td>
<td>(Lunch Bag Woodland)</td>
<td>(Lunch Bag Red Retrospot)</td>
<td>0.051863</td>
<td>0.080272</td>
<td>0.027144</td>
<td>0.523374</td>
<td>6.520010</td>
<td>0.022981</td>
<td>1.929664</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36</td>
<td>(Jumbo Bag Woodland Animals)</td>
<td>(Jumbo Storage Bag Suki)</td>
<td>0.044115</td>
<td>0.060507</td>
<td>0.023033</td>
<td>0.522103</td>
<td>8.628794</td>
<td>0.020363</td>
<td>1.965889</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>(Charlotte Bag Suki Design)</td>
<td>(Woodland Charlotte Bag)</td>
<td>0.045011</td>
<td>0.042587</td>
<td>0.023085</td>
<td>0.512881</td>
<td>12.043172</td>
<td>0.021169</td>
<td>1.965459</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">38</td>
<td>(Lunch Bag Suki Design)</td>
<td>(Lunch Bag Red Retrospot)</td>
<td>0.066041</td>
<td>0.080272</td>
<td>0.033785</td>
<td>0.511572</td>
<td>6.372987</td>
<td>0.028484</td>
<td>1.883038</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>These MBA metrics are commonly used in association rule mining, a data mining technique used to identify relationships and patterns among items in a dataset. Here’s a brief explanation of each metric:</p>
<ul>
<li><p>Antecedent support: This refers to the proportion of transactions that contain the antecedent (or the “if” part of a rule). It is calculated as the number of transactions containing the antecedent divided by the total number of transactions.</p></li>
<li><p>Consequent support: This refers to the proportion of transactions that contain the consequent (or the “then” part of a rule). It is calculated as the number of transactions containing the consequent divided by the total number of transactions.</p></li>
<li><p>Support: This refers to the proportion of transactions that contain both the antecedent and the consequent. It is calculated as the number of transactions containing both the antecedent and the consequent divided by the total number of transactions.</p></li>
<li><p>Confidence: This measures the strength of the association between the antecedent and the consequent. It is calculated as the support of the antecedent and consequent divided by the support of the antecedent. Confidence can range from 0 to 1, with higher values indicating stronger associations.</p></li>
<li><p>Lift: This measures the degree to which the presence of the antecedent affects the likelihood of the consequent. It is calculated as the support of the antecedent and consequent divided by the product of the support of the antecedent and the support of the consequent. A lift value greater than 1 indicates a positive association between the antecedent and consequent, while a value less than 1 indicates a negative association.</p></li>
<li><p>Leverage: This measures the difference between the observed frequency of the antecedent and consequent co-occurring and the frequency expected if they were independent. It is calculated as the support of the antecedent and consequent minus the product of the support of the antecedent and the support of the consequent. A positive leverage value indicates a positive association between the antecedent and consequent, while a negative value indicates a negative association.</p></li>
<li><p>Conviction: This measures the degree of implication of the rule. It is calculated as the ratio of the support of the antecedent to the complement of the confidence. Conviction can range from 0 to infinity, with higher values indicating stronger implications.</p></li>
</ul>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>support_table <span class="op">=</span> rules.pivot(index<span class="op">=</span><span class="st">'consequents'</span>, columns<span class="op">=</span><span class="st">'antecedents'</span>, values<span class="op">=</span><span class="st">'support'</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>sns.heatmap(support_table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>&lt;Axes: xlabel='antecedents', ylabel='consequents'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="e-commerce-analytics_files/figure-html/cell-37-output-2.png" width="1131" height="992"></p>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="37">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(rules, x<span class="op">=</span><span class="st">'support'</span>, y<span class="op">=</span><span class="st">'confidence'</span>, size<span class="op">=</span><span class="st">'lift'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>&lt;Axes: xlabel='support', ylabel='confidence'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="e-commerce-analytics_files/figure-html/cell-38-output-2.png" width="597" height="429"></p>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>